;REMOTE SCRIPT START
;dllcall("ddraw.dll\SetAppCompatData", uint, 12, uint, 0)
logerr(IDirectDraw2.Hook("GetAvailableVidMem"))

g_.D3DDDIARG_TEXTURESTAGESTATE       :=  struct("uint stage; uint state; uint val")
g_.D3DDDIARG_TEXTURESTAGESTATE.stage := 0 ,g_.D3DDDIARG_TEXTURESTAGESTATE.state := 16, G_D3DDDI.D3DDDIARG_RENDERSTATE.val := 1


IDirectDraw2_GetAvailableVidMem(p1, p2, p3, p4)
{
	total:=0, free:=0
	if !(r := dllcall(IDirectDraw2.GetAvailableVidMem, uint, p1, uint, p2, "uint*", total, "uint*", free))
	{
		if (total >= 0x80000000)
		{
			total >>= 1
			free  >>= 1
		}
		p3 ? numput(total, p3+0, "uint")
		p4 ? numput(free, p4+0, "uint")
	}
	return r
}

Alt_EndScene(p1)
{
	(g_.cfg.nofltr) ? dllcall(G_D3DDDI.SetTextureStageState, uint, D3DDDI_HOOKS.hCurrent_Device, uint, g_.D3DDDIARG_TEXTURESTAGESTATE[])	
	return IDirect3DDevice_EndScene(p1)
}